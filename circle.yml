machine:
  ruby:
    version: 2.3.3
  environment:
    FINDINGAIDS_FULL_HOST: dlib.nyu.edu
    FINDINGAIDS_FULL_PATH: /findingaids/html
    FINDINGAIDS_FULL_DEFAULT_EXTENSION: html
    MAX_WAIT: 60

dependencies:
  pre:
    - bundle config --global github.https true

database:
  override:
    - mysql -e 'create database findingaids_test;'
    - RAILS_ENV=test bundle exec rake db:schema:load
    - bundle exec rake db:fixtures:load
  # post:
  #   - cp -R /opt/solr-4.3.1 $HOME/solr-test
  #   - cp solr/conf/schema.xml $HOME/solr-test/example/solr/collection1/conf
  #   - cp solr/conf/solrconfig.xml $HOME/solr-test/example/solr/collection1/conf
  #   - cd $HOME/solr-test/example; java -jar start.jar >> $HOME/solr.log:
  #       background: true

test:
  pre:
    - RAILS_ENV=test bundle exec solr_wrapper
        background: true
    - sleep 10 && wget --waitretry=5 --retry-connrefused -v http://127.0.0.1:8983/solr
  override:
    - RAILS_ENV=test bundle exec rake
