machine:

  ruby:
    version: 2.3.3

  environment:
    FINDINGAIDS_FULL_HOST: dlib.nyu.edu
    FINDINGAIDS_FULL_PATH: /findingaids/html
    FINDINGAIDS_FULL_DEFAULT_EXTENSION: html
    MAX_WAIT: 60

database:
  override:
    - RAILS_ENV=test bundle exec rake db:setup

dependencies:
  pre:
    - bundle config --global github.https true
  post:
    - RAILS_ENV=test bundle exec solr_wrapper:
        background: true
    - sleep 10; curl --retry 10 --retry-delay 5 -v http://127.0.0.1:8983

deployment:
  production:
    branch: master
    commands:
      - curl -u $JENKINS_USERNAME:$JENKINS_API_KEY -X POST http://jenkins.library.nyu.edu/view/Finding%20Aids/job/Finding%20Aids%20Production%20Deploy/build/api
  development:
    branch: /.+/
    commands:
      - curl -u $JENKINS_USERNAME:$JENKINS_API_KEY -X POST http://jenkins.library.nyu.edu/view/Finding%20Aids/job/Finding%20Aids%20Development%20Deploy/build/api
