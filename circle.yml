machine:
  pre:
    - curl -L https://github.com/docker/compose/releases/download/1.10.0/docker-compose-`uname -s`-`uname -m` > /home/ubuntu/bin/docker-compose
    - chmod +x /home/ubuntu/bin/docker-compose
    - docker-compose version
  services:
    - docker

dependencies:
  override:
    - docker-compose up -d

database:
  override:
    - echo "All good"

test:
  override:
    - docker-compose exec -e RAILS_ENV=test app rake

deployment:
  production:
    branch: master
    commands:
      - curl -u $JENKINS_USERNAME:$JENKINS_API_KEY -X POST http://jenkins.library.nyu.edu/view/Finding%20Aids/job/Finding%20Aids%20Production%20Deploy/build/api
  development:
    branch: /.+/
    commands:
      - curl -u $JENKINS_USERNAME:$JENKINS_API_KEY -X POST http://jenkins.library.nyu.edu/view/Finding%20Aids/job/Finding%20Aids%20Development%20Deploy/build/api
